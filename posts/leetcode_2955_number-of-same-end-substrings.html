
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://tofucode.com/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://tofucode.com/theme/pygments/monokai.min.css">

    <script src="https://tofucode.com/theme/tipuesearch/jquery.min.js"></script>
    <script src="https://tofucode.com/theme/tipuesearch/tipuesearch.min.js"></script>
    <script src="https://tofucode.com/theme/tipuesearch/tipuesearch.min.js"></script>
    <script src="https://tofucode.com/theme/tipuesearch/tipuesearch_set.min.js"></script>
    <script src="https://tofucode.com/tipuesearch_content.js"></script>
    <link rel="stylesheet" href="https://tofucode.com/theme/tipuesearch/tipuesearch.min.css" />

  <link rel="stylesheet" type="text/css" href="https://tofucode.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://tofucode.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://tofucode.com/theme/font-awesome/css/solid.css">


    <link href="https://tofucode.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="TofuCode Atom">



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-DCBDZPQQD1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->  


<meta name="author" content="Zeph" />
<meta name="description" content="Question Link : https://leetcode.com/problems/number-of-same-end-substrings/ Difficulty: Medium Premium: False Question You are given a 0-indexed string s, and a 2D array of integers queries, where queries[i] = [li, ri] indicates a substring of s starting from the index li and ending at the index ri (both inclusive), i …" />
<meta name="keywords" content="math, binary-search, prefix-sum">


<meta property="og:site_name" content="TofuCode"/>
<meta property="og:title" content="Leetcode 2955. Number of Same-End Substrings"/>
<meta property="og:description" content="Question Link : https://leetcode.com/problems/number-of-same-end-substrings/ Difficulty: Medium Premium: False Question You are given a 0-indexed string s, and a 2D array of integers queries, where queries[i] = [li, ri] indicates a substring of s starting from the index li and ending at the index ri (both inclusive), i …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://tofucode.com/posts/leetcode_2955_number-of-same-end-substrings.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2024-11-21 00:00:00-08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://tofucode.com/author/zeph.html">
<meta property="article:section" content="Leetcode"/>
<meta property="article:tag" content="math"/>
<meta property="article:tag" content="binary-search"/>
<meta property="article:tag" content="prefix-sum"/>
<meta property="og:image" content="">

  <title>TofuCode &ndash; Leetcode 2955. Number of Same-End Substrings</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="https://tofucode.com">
        <img src="https://tofucode.com/theme/img/profile.png" alt="TofuCode" title="TofuCode">
      </a>

      <h1>
        <a href="https://tofucode.com">TofuCode</a>
      </h1>

      
      <ul class="list social">
      </ul>

        <form class="navbar-search" action="/search.html" role="search">
          <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
        </form>

      <nav>
        <ul class="list">



            <li>
              <a target="_self" href="/pages/interview-questions.html" >Interview Questions</a>
            </li>
            <li>
              <a target="_self" href="/category/leetcode.html" >Recent Questions</a>
            </li>
            <li>
              <a target="_self" href="/tags.html" >Tags</a>
            </li>
        </ul>
      </nav>

    </div>

  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="leetcode_2955_number-of-same-end-substrings">Leetcode 2955. Number of Same-End Substrings</h1>
    <p>
      Posted on Thu 21 November 2024 in <a href="https://tofucode.com/category/leetcode.html">Leetcode</a>

    </p>
  </header>


  <div>
    <p>Question Link : <a href="https://leetcode.com/problems/number-of-same-end-substrings/">https://leetcode.com/problems/number-of-same-end-substrings/</a></p>
<p>Difficulty: Medium</p>
<p>Premium: False</p>
<h3>Question</h3>
<p>You are given a 0-indexed string s, and a 2D array of integers queries, where queries[i] = [li, ri] indicates a substring of s starting from the index li and ending at the index ri (both inclusive), i.e. s[li..ri].
Return an array ans where ans[i] is the number of same-end substrings of queries[i].
A 0-indexed string t of length n is called same-end if it has the same character at both of its ends, i.e., t[0] == t[n - 1].
A substring is a contiguous non-empty sequence of characters within a string.
 
Example 1:</p>
<p>Input: s = "abcaab", queries = [[0,0],[1,4],[2,5],[0,5]]
Output: [1,5,5,10]
Explanation: Here is the same-end substrings of each query:
1st query: s[0..0] is "a" which has 1 same-end substring: "a".
2nd query: s[1..4] is "bcaa" which has 5 same-end substrings: "bcaa", "bcaa", "bcaa", "bcaa", "bcaa".
3rd query: s[2..5] is "caab" which has 5 same-end substrings: "caab", "caab", "caab", "caab", "caab".
4th query: s[0..5] is "abcaab" which has 10 same-end substrings: "abcaab", "abcaab", "abcaab", "abcaab", "abcaab", "abcaab", "abcaab", "abcaab", "abcaab", "abcaab".</p>
<p>Example 2:</p>
<p>Input: s = "abcd", queries = [[0,3]]
Output: [4]
Explanation: The only query is s[0..3] which is "abcd". It has 4 same-end substrings: "abcd", "abcd", "abcd", "abcd".</p>
<p>Constraints:</p>
<p>2 &lt;= s.length &lt;= 3 * 104
s consists only of lowercase English letters.
1 &lt;= queries.length &lt;= 3 * 104
queries[i] = [li, ri]
0 &lt;= li &lt;= ri &lt; s.length</p>
<h3>Solution</h3>
<p>The main observation to make is that given each query, what matters is the number of occurance every char and use that to calculate the number of substrings for that char. To find the number of occurances, one can use: 1) linear search 2) binary search 3) prefix sum </p>
<h3>Code</h3>
<div class="highlight"><pre><span></span><code><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Leetcode 2955. Number of Same-End Substrings</span>
<span class="sd">Question Link : https://leetcode.com/problems/number-of-same-end-substrings/</span>
<span class="sd">Solution Link : https://tofucode.com/posts/leetcode_2955_number-of-same-end-substrings.html</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="k">class</span> <span class="nc">Solution</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sameEndSubstringCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">queries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        s = &quot;abcaab&quot;, queries = [[0,0],[1,4],[2,5],[0,5]]</span>
<span class="sd">        query: left and right inclusive</span>
<span class="sd">        same-end: if it has the same character at both of its ends, i.e., t[0] == t[n - 1].</span>

<span class="sd">        abcaab</span>
<span class="sd">        012345</span>
<span class="sd">        process s: for each char have a char-&gt;[position]</span>
<span class="sd">        a-&gt;[0, 3, 4]</span>
<span class="sd">        b-&gt;[1, 5]</span>
<span class="sd">        c-&gt;[2]</span>

<span class="sd">        for each query check the overlap of it between [position]</span>
<span class="sd">        [0,0] just a: 1</span>
<span class="sd">        [1,4] overlaps a[3, 4], b [1], c[2]</span>
<span class="sd">        a[3, 4]: 1 + 1 + 2 (combination: 2 + 1 )</span>
<span class="sd">        b[1]: 1</span>
<span class="sd">        c[2]: 1</span>

<span class="sd">        eg. abcaab a:[0, 3, 4]: 6 = 3 + 2 + 1</span>
<span class="sd">        6 = (1 + 3) * 3 / 2</span>

<span class="sd">        s of n length, q queries</span>
<span class="sd">        Time : O(n + nq) This will TLE</span>
<span class="sd">        Space: O(q)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># build char to positions mapping</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># char -&gt; [idx]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">positions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>


        <span class="c1"># go through each query</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">query</span>
            <span class="c1"># check overlap</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">position_list</span> <span class="ow">in</span> <span class="n">positions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">overlap_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">position_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">:</span>
                        <span class="n">overlap_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">overlap_count</span><span class="p">)</span> <span class="o">*</span> <span class="n">overlap_count</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span> <span class="nc">SolutionImproved1</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sameEndSubstringCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">queries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Improved to binary search</span>

<span class="sd">        s = &quot;abcaab&quot;, queries = [[0,0],[1,4],[2,5],[0,5]]</span>
<span class="sd">        query: left and right inclusive</span>
<span class="sd">        same-end: if it has the same character at both of its ends, i.e., t[0] == t[n - 1].</span>

<span class="sd">        abcaab</span>
<span class="sd">        012345</span>
<span class="sd">        process s: for each char have a char-&gt;[position]</span>
<span class="sd">        a-&gt;[0, 3, 4]</span>
<span class="sd">        b-&gt;[1, 5]</span>
<span class="sd">        c-&gt;[2]</span>

<span class="sd">        for each query check the overlap of it between [position]</span>
<span class="sd">        [0,0] just a: 1</span>
<span class="sd">        [1,4] overlaps a[3, 4], b [1], c[2]</span>
<span class="sd">        a[3, 4]: 1 + 1 + 2 (combination: 2 + 1 )</span>
<span class="sd">        b[1]: 1</span>
<span class="sd">        c[2]: 1</span>

<span class="sd">        eg. abcaab a:[0, 3, 4]: 6 = 3 + 2 + 1</span>
<span class="sd">        6 = (1 + 3) * 3 / 2</span>

<span class="sd">        s of n length, q queries</span>
<span class="sd">        Time : O(n + q * log n)</span>
<span class="sd">        Space: O(q)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># build char to positions mapping</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># char -&gt; [idx]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">positions</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>


        <span class="c1"># go through each query</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">query</span>
            <span class="c1"># check overlap</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">position_list</span> <span class="ow">in</span> <span class="n">positions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">left_bound</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">position_list</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
                <span class="n">right_bound</span> <span class="o">=</span> <span class="n">bisect_right</span><span class="p">(</span><span class="n">position_list</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                <span class="n">overlap_count</span> <span class="o">=</span> <span class="n">right_bound</span> <span class="o">-</span> <span class="n">left_bound</span>

                <span class="n">total</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">overlap_count</span><span class="p">)</span> <span class="o">*</span> <span class="n">overlap_count</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span> <span class="nc">SolutionImproved2</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sameEndSubstringCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">queries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Improved to prefix sum</span>

<span class="sd">        s = &quot;abcaab&quot;, queries = [[0,0],[1,4],[2,5],[0,5]]</span>
<span class="sd">        query: left and right inclusive</span>
<span class="sd">        same-end: if it has the same character at both of its ends, i.e., t[0] == t[n - 1].</span>

<span class="sd">        abcaab</span>
<span class="sd">        012345</span>
<span class="sd">        n = 6</span>
<span class="sd">        first frequence:</span>
<span class="sd">        a: [1, 0, 0, 1, 1, 0]</span>
<span class="sd">        then prefix sum:</span>
<span class="sd">        a: [1, 1, 1, 2, 3, 0]</span>
<span class="sd">        a:</span>
<span class="sd">        [0,0] just a at position 0: 1</span>
<span class="sd">        [1,4] = 3</span>

<span class="sd">        s of n length, q queries</span>
<span class="sd">        Time : O(n + q)</span>
<span class="sd">        Space: O(n)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># prefix sum 2d array: every row is a char&#39;s prefix sum array</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">prefix_sum</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">26</span><span class="p">)]</span>

        <span class="c1"># calculate frequency</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">prefix_sum</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># calculate prefix sum</span>
        <span class="k">for</span> <span class="n">char_prefix</span> <span class="ow">in</span> <span class="n">prefix_sum</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">char_prefix</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">char_prefix</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># go through each query</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">query</span>
            <span class="c1"># check overlap</span>
            <span class="k">for</span> <span class="n">char_prefix</span> <span class="ow">in</span> <span class="n">prefix_sum</span><span class="p">:</span>
                <span class="n">left_freq</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">char_prefix</span><span class="p">[</span><span class="n">l</span><span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">right_freq</span> <span class="o">=</span> <span class="n">char_prefix</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                <span class="n">overlap_count</span> <span class="o">=</span> <span class="n">right_freq</span> <span class="o">-</span> <span class="n">left_freq</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">overlap_count</span><span class="p">)</span> <span class="o">*</span> <span class="n">overlap_count</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://tofucode.com/tag/math.html">math</a>
      <a href="https://tofucode.com/tag/binary-search.html">binary-search</a>
      <a href="https://tofucode.com/tag/prefix-sum.html">prefix-sum</a>
    </p>
  </div>





</article>

    <footer>
<p> Eat Tofu and be true </p>
<p>&copy; 2024 TofuCode.com</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " TofuCode ",
  "url" : "https://tofucode.com",
  "image": "",
  "description": ""
}
</script>

    <script>
      $(document).ready(function() {
        $('#tipue_search_input').tipuesearch();
      });
    </script>

</body>
</html>